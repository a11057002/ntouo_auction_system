<!DOCTYPE HTML>
<!--
	Aerial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<meta charset = "utf-8">
		<title>LogIn Pattern</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../static/assets/css/main.css" />
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
		<noscript><link rel="stylesheet" href="../static/assets/css/noscript.css" /></noscript>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://www.gstatic.com/firebasejs/5.11.0/firebase.js"></script>
		<script src="https://www.gstatic.com/firebasejs/5.11.0/firebase-app.js"></script>
		<script src="https://www.gstatic.com/firebasejs/5.11.0/firebase-auth.js"></script>
		
	</head>
	<body id="is-preload">
		<div id="wrapper">
			<div id="bg"></div>
			<div id="overlay"></div>
			<div id="main">

				<!-- Header -->
					<header id="header">
						<div>
							<h2>登入</h2>
						</div>
						<br>
						<form class="w3-container">
							<label class="w3-text-white"><b>帳號</b></label>
							<input class="w3-input w3-border w3-light-grey" type="text" id="accBox">
							<br>
							<label class="w3-text-white"><b>密碼</b></label>
							<input class="w3-input w3-border w3-light-grey" type="password" id="passBox" maxlength="16">
							<span toggle="#passBox" class="fa fa-fw fa-eye field-icon toggle-password" style="color:black;"></span>
							<p class='infoWrong' id="passAlert"></p>
							<br>
							<button type="button" class="w3-btn w3-blue-grey" onclick="doLogIn()">登入</button>
							<br>
							<p>沒有帳號嗎?</p> <button type="button" onclick="location.href='pre-SignUp.html'" class="w3-btn w3-blue-grey">註冊</button>
						</form>
						<p>或使用第三方認證</p>
						<nav>
							<ul>
								<li><a class="icon fa-twitter" onclick="pop()"><span class="label">Twitter</span></a></li>
								<li><a href="#" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
								<li><a href="#" class="icon fa-dribbble"><span class="label">Dribbble</span></a></li>
								<li><a href="#" class="icon fa-github"><span class="label">Github</span></a></li>
								<li><a href="#" class="icon fa-envelope-o"><span class="label">Email</span></a></li>
							</ul>
						</nav>
					</header>

				<!-- Footer -->
					<footer id="footer">
						<span class="copyright">&copy; Untitled. Design: <a href="http://html5up.net">HTML5 UP</a>.</span>
					</footer>

			</div>
		</div>
		<script>
			window.onload = function() { document.body.classList.remove('is-preload'); }
			window.ontouchmove = function() { return false; }
			window.onorientationchange = function() { document.body.scrollTop = 0; }
		     // Your web app's Firebase configuration
				var firebaseConfig = {
					apiKey: "AIzaSyCF_Q4YD_W7FWb40pDU-NHW0ooYsnJWDUM",
					authDomain: "auction-system-73960.firebaseapp.com",
					databaseURL: "https://auction-system-73960.firebaseio.com",
					projectId: "auction-system-73960",
					storageBucket: "auction-system-73960.appspot.com",
					messagingSenderId: "650872511305",
					appId: "1:650872511305:web:8afe3f2f1c33b4f6"
				};
				// Initialize Firebase
				firebase.initializeApp(firebaseConfig);

				function signUpString() {
					return (location.href = '{% url "SignUp" %}').toString();
				}

				function setSession(idToken) {
					$.post('{% url "set-session" %}', { 'idToken': idToken }, function (response) {
						console.log(response);
					});
				}

				function pop() {
					var provider = new firebase.auth.GoogleAuthProvider();
					// firebase.auth().signInWithRedirect(provider);
					firebase.auth().signInWithPopup(provider).then(function (result) {
						// This gives you a Google Access Token. You can use it to access the Google API.
						var token = result.credential.accessToken;
						// The signed-in user info.
						var user = result.user;
						// ...
						console.log(firebase.auth().currentUser.email);
					}).catch(function (error) {
						a = "g";
						// Handle Errors here.
						var errorCode = error.code;
						var errorMessage = error.message;
						// The email of the user's account used.
						var email = error.email;
						// The firebase.auth.AuthCredential type that was used.
						var credential = error.credential;
						// ...
						console.log('ERROR');
					});

					firebase.auth().onAuthStateChanged(function (user) {
						if (user) {
							// User is signed in.
							user.getIdToken().then(function (idToken) {
								console.log(idToken);
								setSession(idToken);
								var isLoggedIn = " ";
								// location.href = '{% url "welcome" %}';
								
							});
						} else {
							// No user is signed in.
							console.log('not SignIn');
						}
					});
				}

				function log() {
					firebase.auth().signOut().then(function () {
						// Sign-out successful.
						console.log('here');
					}).catch(function (error) {
						// An error happened.
					});
				}

				function doLogIn()
				{
					console.log("Check LogIn");
					//todo post //把密碼和帳號丟到DB檢查
					var isMember = fasle;
					

					if(isMember)
					{
						//todo 確認登入 跳回主畫面
						//location.href = '{% url "welcome" %}';
					}
				}
				$(".toggle-password").click(function () {

					$(this).toggleClass("fa-eye fa-eye-slash");
					var input = $($(this).attr("toggle"));
					if (input.attr("type") == "password") {
						input.attr("type", "text");
					} 
					else {
						input.attr("type", "password");
					}
});
		</script>
	</body>
</html>